# Домашняя работа к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

> Предлагаемый стек:
> - **Bitbucket** - это система контроля версий и совместной разработки от Atlassian, которая поддерживает Git и Mercurial. Она предлагает встроенные инструменты для непрерывной интеграции и доставки (CI/CD).
> - **Jenkins** - это популярный инструмент для непрерывной интеграции и доставки (CI/CD), который может быть интегрирован с Bitbucket. Он позволяет запускать сборку по событию из системы контроля версий и по кнопке с указанием параметров.
> - **Nexus** - это прокси-репозиторий для Maven и NuGet, который может использоваться для хранения артефактов сборки и зависимостей. Он также может быть использован для управления сертификатами безопасности и секретными данными.
> - **Secman** - это инструмент для управления секретами и конфиденциальными данными в DevOps-процессах. Он позволяет безопасно хранить пароли, ключи доступа и другие чувствительные данные, которые необходимы для работы приложений. Secman может быть интегрирован с Bitbucket, Jenkins и другими инструментами из предложенного стека, чтобы обеспечить безопасность и защиту конфиденциальных данных в процессе разработки и эксплуатации.
> - **OpenShift** - это платформа как услуга (PaaS) на базе Kubernetes, предоставляемая Red Hat. Она предлагает управляемую среду для развёртывания, масштабирования и управления приложениями в контейнерах. OpenShift предоставляет дополнительные сервисы, такие как мониторинг, балансировка нагрузки.
> 
> Данный стек отвечает требованиям. Так же по каждому инструменту есть огромное количество документаций, сообществ. 

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

> Для решения задачи сбора и анализа логов в микросервисной архитектуре я предлагаю использовать EF(L)K стек технологий:
> 
> - **Elasticsearch** - это распределенная база данных, предназначенная для полнотекстового поиска и аналитики в реальном времени. Elasticsearch может использоваться для хранения собранных Fluentd логов и обеспечения быстрого поиска и фильтрации по ним.
> - **Kibana** - это пользовательский интерфейс для Elasticsearch, который предоставляет возможности визуализации и анализа данных. Kibana позволяет разработчикам искать записи логов, фильтровать их по различным параметрам и даже создавать дашборды для мониторинга состояния системы.
> - **Fluentd** - это инструмент для сбора и агрегации логов из различных источников. Fluentd может собирать логи из стандартного вывода (stdout) приложений, что соответствует требованию о минимальных требованиях к приложениям. Fluentd также поддерживает различные форматы логов, включая JSON, что упрощает их анализ.
> - **Logstash** - это инструмент для обработки потоковых данных, который может быть использован для обогащения логов перед их отправкой в Elasticsearch. Logstash может добавить дополнительную информацию, такую как метки времени, IP-адреса и другие контекстные данные, что делает анализ логов еще более информативным.
> 
> Выбор этих инструментов обусловлен следующими преимуществами:
> 
> - Elasticsearch гарантирует быстрый поиск и фильтрацию благодаря индексации данных в реальном времени.
> - Kibana предоставляет удобный и мощный интерфейс для разработчиков, позволяя им легко находить и анализировать логи.
> - Fluentd обеспечивает гибкость и масштабируемость при сборе логов из различных источников.
> - Logstash может быть использован для обогащения логов, что улучшает качество аналитики.
> 
> Таким образом, данный стек технологий позволяет удовлетворить все требования задачи, обеспечивая централизованный сбор логов, гарантированную доставку, поиск и фильтрацию, а также удобный пользовательский интерфейс для разработчиков.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

> Для решения задачи мониторинга состояния хостов и сервисов в микросервисной архитектуре я предлагаю использовать следующий стек технологий:
> 
> - **Prometheus** - это система мониторинга и сбора метрик, которая позволяет собирать данные о состоянии хостов и сервисов. Prometheus поддерживает широкий спектр метрик, включая CPU, RAM, HDD, Network, а также позволяет собирать специфичные для каждого сервиса метрики.
> - **Grafana** - это инструмент для визуализации данных, который может быть использован для создания панелей мониторинга и дашбордов. Grafana позволяет пользователям задавать запросы и агрегировать информацию, а также настраивать различные панели для отслеживания состояния системы.
> - **Node Exporter** - это агент Prometheus, который собирает и экспортирует метрики с хоста. Node Exporter может собирать информацию о CPU, RAM, HDD, Network и других ресурсах хоста.
> - **Service Monitors** - это часть Prometheus, которая позволяет настроить мониторинг конкретных сервисов. Service Monitors могут быть настроены для сбора специфичных для каждого сервиса метрик.
> - **Prometheus Operator** - это инструмент, который автоматизирует управление Prometheus в кластере Kubernetes. Он позволяет легко настраивать и управлять Prometheus, а также обеспечивает поддержку ServiceMonitors для мониторинга микросервисов.
> 
> Выбор этих инструментов обусловлен следующими преимуществами:
> - Prometheus обеспечивает надежный и масштабируемый сбор метрик, а также предоставляет богатый набор метрик для мониторинга системных ресурсов и сервисов.
> - Grafana предоставляет мощный и интуитивно понятный интерфейс для визуализации данных и создания панелей мониторинга.
> - Node Exporter и Service Monitors позволяют собирать специфичные для каждого хоста и сервиса метрики, что обеспечивает глубокое понимание состояния системы.
> - Prometheus Operator автоматизирует управление Prometheus, обеспечивает его масштабируемость в кластере Kubernetes, поддерживает ServiceMonitors для мониторинга микросервисов, управляет ресурсами Prometheus, настраивает безопасность и облегчает обновления.
> 
> - Таким образом, данный стек технологий позволяет удовлетворить все требования задачи, обеспечивая сбор и анализ метрик состояния хостов и сервисов, а также предоставляя удобный пользовательский интерфейс для мониторинга и анализа данных.
